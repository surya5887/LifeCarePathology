{% extends 'admin/admin_base.html' %}
{% block title %}Report Templates{% endblock %}
{% block page_title %}Report Templates{% endblock %}

{% block content %}
<style>
    .tpl-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; margin-top: 20px; }
    .tpl-card { background: var(--admin-card-bg); border-radius: 14px; overflow: hidden;
        border: 1px solid rgba(255,255,255,0.06); transition: transform .2s; }
    .tpl-card:hover { transform: translateY(-4px); }
    .tpl-img { width: 100%; height: 300px; object-fit: contain; background: #fff; padding: 8px; }
    .tpl-info { padding: 14px; display: flex; justify-content: space-between; align-items: center; }
    .tpl-name { font-weight: 700; font-size: 14px; }
    .tpl-date { font-size: 11px; color: #64748B; }
    .tpl-del { background: rgba(239,68,68,0.15); color: var(--admin-danger); border: none;
        padding: 6px 14px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; }
    .upload-card { background: var(--admin-card-bg); border-radius: 14px; padding: 24px;
        border: 2px dashed rgba(59,130,246,0.3); }
    .upload-card h3 { font-size: 15px; font-weight: 700; color: var(--admin-primary); margin: 0 0 16px;
        display: flex; align-items: center; gap: 8px; }
    .upload-grid { display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end; }
    .upload-grid label { display: block; font-size: 11px; color: #94A3B8; text-transform: uppercase;
        font-weight: 600; margin-bottom: 4px; }
    .upload-grid input[type="text"] { padding: 10px 14px; border: 1px solid rgba(255,255,255,0.08);
        border-radius: 8px; background: rgba(255,255,255,0.04); color: var(--admin-text); font-size: 13px;
        min-width: 200px; }
    .upload-grid input[type="text"]:focus { border-color: var(--admin-primary); outline: none; }
    .upload-grid input[type="file"] { padding: 8px; border: 1px solid rgba(255,255,255,0.08);
        border-radius: 8px; background: rgba(255,255,255,0.04); color: var(--admin-text); font-size: 13px; }
    .btn-upload { background: linear-gradient(135deg, #10B981, #059669); color: #fff;
        border: none; padding: 12px 28px; border-radius: 8px; font-weight: 700; cursor: pointer;
        font-size: 14px; display: inline-flex; align-items: center; gap: 8px;
        transition: transform .2s, box-shadow .2s; }
    .btn-upload:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(16,185,129,0.35); }
</style>

<!-- Upload new template -->
<form method="POST" action="{{ url_for('admin.upload_template') }}" enctype="multipart/form-data" class="upload-card">
    <h3><i class="fas fa-upload"></i> Upload New Template</h3>
    <div class="upload-grid">
        <div>
            <label>Template Name *</label>
            <input type="text" name="name" required placeholder="e.g. Life Care Letterhead">
        </div>
        <div>
            <label>Image File (PNG/JPG) *</label>
            <input type="file" name="template_file" accept=".png,.jpg,.jpeg,.webp" required>
        </div>
        <button type="submit" class="btn-upload">
            <i class="fas fa-save"></i> Save Template
        </button>
    </div>
</form>

<!-- Existing templates -->
{% if templates %}
<div class="tpl-grid">
    {% for t in templates %}
    <div class="tpl-card">
        <img src="{{ url_for('static', filename='images/templates/' + t.file_path) }}"
             alt="{{ t.name }}" class="tpl-img">
        <div class="tpl-info">
            <div>
                <div class="tpl-name">{{ t.name }}</div>
                <div class="tpl-date">{{ t.created_at.strftime('%d %b %Y') }}</div>
            </div>
            <form method="POST" action="{{ url_for('admin.delete_template', tpl_id=t.id) }}"
                  onsubmit="return confirm('Delete this template?')">
                <button type="submit" class="tpl-del"><i class="fas fa-trash"></i> Delete</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div style="text-align:center; padding:60px; color:#64748B;">
    <i class="fas fa-images" style="font-size:48px; margin-bottom:16px; display:block;"></i>
    <h3>No templates uploaded yet</h3>
    <p>Upload your lab letterhead image above to use as report background.</p>
</div>
{% endif %}
{% endblock %}
